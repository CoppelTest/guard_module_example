!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.guard_module=t():e.guard_module=t()}(self,(()=>{return e={440:function(e,t,o){var r,i,n,s,c,a,d,u,l,h=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},f=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),p=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||f(t,e,o)};r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){if(!e.startsWith("https://"))throw new Error("La URL base debe utilizar HTTPS.");this.baseUrl=e}get(e,t={}){return h(this,void 0,void 0,(function*(){try{const o=yield fetch(`${this.baseUrl}${e}`,{method:"GET",headers:Object.assign({},t)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return yield o.json()}catch(e){throw console.error("Error in GET request:",e),e}}))}post(e,t,o={}){return h(this,void 0,void 0,(function*(){try{const r=yield fetch(`${this.baseUrl}${e}`,{method:"POST",headers:Object.assign({"Content-Type":"application/json"},o),body:JSON.stringify(t)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return yield r.json()}catch(e){throw console.error("Error in POST request:",e),e}}))}put(e,t,o={}){return h(this,void 0,void 0,(function*(){try{const r=yield fetch(`${this.baseUrl}${e}`,{method:"PUT",headers:Object.assign({"Content-Type":"application/json"},o),body:JSON.stringify(t)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return yield r.json()}catch(e){throw console.error("Error in PUT request:",e),e}}))}delete(e,t={}){return h(this,void 0,void 0,(function*(){try{const o=yield fetch(`${this.baseUrl}${e}`,{method:"DELETE",headers:Object.assign({},t)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}catch(e){throw console.error("Error in DELETE request:",e),e}}))}postDataFormUrlEncoded(e,t){return h(this,void 0,void 0,(function*(){try{const o=Object.keys(t).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e]))).join("&"),r=yield fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return yield r.json()}catch(e){throw console.error("Error in POST request:",e),e}}))}}}.apply(i={},[o,t]),void 0!==r||(r=i),n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends Error{constructor(e,t){super(t),this.code=e,this.name="CustomError",Error.captureStackTrace?Error.captureStackTrace(this,o):this.stack=(new Error).stack}toJSON(){return{code:this.code,message:this.message}}}t.default=o}.apply(s={},[o,t]),void 0!==n||(n=s),c=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setupRequestInterceptor=void 0,t.setupRequestInterceptor=()=>{var e;e=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(t,o,r,i,n){e.call(this,t,o,r,i,n);const s=localStorage.getItem("access_token");s&&this.setRequestHeader("Authorization",`Bearer ${s}`)}}}.apply(a={},[o,t]),void 0!==c||(c=a),d=function(e,t,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0;class i{constructor(e){this.config=e}static initialize(e){if(!i._instance){const t={domain:e.domain,clientId:e.clientId,redirectUri:e.redirectUri};i._instance=new i(t)}}static getInstance(){return i._instance}generateCodeVerifier(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).slice(-2))).join("")}generateState(){return Math.random().toString(36).substring(2)}generateCodeChallenge(e){return h(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),o=yield window.crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode(...Array.from(new Uint8Array(o)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}))}login(e){return h(this,void 0,void 0,(function*(){const t=window.location.href.includes("tienda")?this.getCookie("WC_CartOrderId_10152"):this.getCookie("WC_CartOrderId_10151"),o=this.generateCodeVerifier();sessionStorage.setItem("code_verifier",o);const r=this.generateState();sessionStorage.setItem("oauth_state",r),sessionStorage.setItem("redirect_after_auth",e);const i=yield this.generateCodeChallenge(o);let n=`https://${this.config.domain}/authorize?response_type=code&client_id=${this.config.clientId}&redirect_uri=${encodeURIComponent(this.config.redirectUri)}&code_challenge=${i}&code_challenge_method=S256&scope=openid profile email&audience=https://www.coppel.com`;t&&(n+=`&orderId=${t}`),window.location.href=n}))}getCookie(e){var t;const o=`; ${document.cookie}`.split(`; ${e}=`);return 2===o.length&&(null===(t=o.pop())||void 0===t?void 0:t.split(";").shift())||null}handleRedirectCallback(e){return h(this,void 0,void 0,(function*(){if(this.isAuthenticated())return;const t=new URLSearchParams(window.location.search),i=sessionStorage.getItem("code_verifier"),n=sessionStorage.getItem("redirect_after_auth"),s=t.get("code");if(!s||!i)throw new r.default(500,"Authorization code or code verifier not found");const c=`https://${this.config.domain}`,a={grant_type:"authorization_code",client_id:this.config.clientId,code:s,redirect_uri:this.config.redirectUri,code_verifier:i},d=new o.default(c);try{const t=yield d.postDataFormUrlEncoded("/oauth/token",a),{access_token:o,id_token:r}=t;sessionStorage.setItem("at",o),sessionStorage.setItem("it",r),e&&(yield e()),window.history.replaceState({},document.title,window.location.pathname),sessionStorage.removeItem("redirect_after_auth"),window.location.href=n}catch(e){throw new r.default(501,"Error in oauth/tokenLe")}}))}handleRedirectCallbackHCL(e){return h(this,void 0,void 0,(function*(){if(this.isAuthenticated())return;const t=new URLSearchParams(window.location.search),i=sessionStorage.getItem("code_verifier"),n=t.get("code");if(!n||!i)throw new r.default(500,"Authorization code or code verifier not found");const s=`https://${this.config.domain}`,c={grant_type:"authorization_code",client_id:this.config.clientId,code:n,redirect_uri:this.config.redirectUri,code_verifier:i},a=new o.default(s);try{const t=yield a.postDataFormUrlEncoded("/oauth/token",c),{access_token:o,id_token:r}=t;sessionStorage.setItem("at",o),sessionStorage.setItem("it",r),e&&(yield e()),window.history.replaceState({},document.title,window.location.pathname),window.location.href=this.config.redirectUri}catch(e){throw new r.default(501,"Error in oauth/tokenLe")}}))}getRedirectAfterAuth(){return sessionStorage.getItem("redirect_after_auth")}validateToken(e){const t=this.getJwtPayload(e),o=Math.floor(Date.now()/1e3);return!(t.exp<o&&(console.error("Token has expired"),1))}getJwtPayload(e){const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(o)}isAuthenticated(){const e=sessionStorage.getItem("it"),t=sessionStorage.getItem("at");if(!e||!t)return!1;const o=this.validateToken(e);return console.log("validateToken: "+o),o}getIdToken(){return sessionStorage.getItem("it")}getAccessToken(){return sessionStorage.getItem("at")}getUserData(){const e=sessionStorage.getItem("it");return e?this.getJwtPayload(e):null}logout(e){sessionStorage.removeItem("at"),sessionStorage.removeItem("it"),window.location.href=`https://${this.config.domain}/v2/logout?client_id=${this.config.clientId}&returnTo=${encodeURIComponent(e)}`}createAccount(e){return h(this,void 0,void 0,(function*(){const t=window.location.href.includes("tienda")?this.getCookie("WC_CartOrderId_10152"):this.getCookie("WC_CartOrderId_10151"),o=this.generateCodeVerifier();sessionStorage.setItem("code_verifier",o);const r=this.generateState();sessionStorage.setItem("oauth_state",r),sessionStorage.setItem("redirect_after_auth",e);const i=yield this.generateCodeChallenge(o);let n=`https://${this.config.domain}/authorize?response_type=code&client_id=${this.config.clientId}&redirect_uri=${encodeURIComponent(this.config.redirectUri)}&code_challenge=${i}&code_challenge_method=S256&scope=openid profile email&audience=https://www.coppel.com&connection=Username-Password-Authentication&screen_hint=signup`;t&&(n+=`&orderId=${t}`),window.location.href=n}))}resetPasswordAccount(){const e=`https://${this.config.domain}/lo/reset?client_id=${this.config.clientId}&connection=Username-Password-Authentication`;window.location.href=e}}t.AuthService=i}.apply(u={},[o,t,r,n]),void 0!==d||(d=u),l=function(e,t,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),p(o,t),p(r,t)}.apply(t,[o,t,d,c]),void 0===l||(e.exports=l)}},t={},function o(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,o),n.exports}(440);var e,t}));