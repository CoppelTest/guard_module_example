!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.guard_module=t():e.guard_module=t()}(self,(()=>{return e={440:function(e,t,o){var r,n,i,c,a,s,d,l,u,h=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,a)}s((r=r.apply(e,t||[])).next())}))},f=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,n)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),p=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||f(t,e,o)};r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){if(!e.startsWith("https://"))throw new Error("La URL base debe utilizar HTTPS.");this.baseUrl=e}get(e,t={}){return h(this,void 0,void 0,(function*(){try{const o=yield fetch(`${this.baseUrl}${e}`,{method:"GET",headers:Object.assign({},t)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return yield o.json()}catch(e){throw console.error("Error in GET request:",e),e}}))}post(e,t,o={}){return h(this,void 0,void 0,(function*(){try{const r=yield fetch(`${this.baseUrl}${e}`,{method:"POST",headers:Object.assign({"Content-Type":"application/json"},o),body:JSON.stringify(t)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return yield r.json()}catch(e){throw console.error("Error in POST request:",e),e}}))}put(e,t,o={}){return h(this,void 0,void 0,(function*(){try{const r=yield fetch(`${this.baseUrl}${e}`,{method:"PUT",headers:Object.assign({"Content-Type":"application/json"},o),body:JSON.stringify(t)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return yield r.json()}catch(e){throw console.error("Error in PUT request:",e),e}}))}delete(e,t={}){return h(this,void 0,void 0,(function*(){try{const o=yield fetch(`${this.baseUrl}${e}`,{method:"DELETE",headers:Object.assign({},t)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}catch(e){throw console.error("Error in DELETE request:",e),e}}))}postDataFormUrlEncoded(e,t){return h(this,void 0,void 0,(function*(){try{const o=Object.keys(t).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e]))).join("&"),r=yield fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return yield r.json()}catch(e){throw console.error("Error in POST request:",e),e}}))}}}.apply(n={},[o,t]),void 0!==r||(r=n),i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends Error{constructor(e,t){super(t),this.code=e,this.name="CustomError",Error.captureStackTrace?Error.captureStackTrace(this,o):this.stack=(new Error).stack}toJSON(){return{code:this.code,message:this.message}}}t.default=o}.apply(c={},[o,t]),void 0!==i||(i=c),a=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setupRequestInterceptor=void 0,t.setupRequestInterceptor=()=>{var e;e=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(t,o,r,n,i){e.call(this,t,o,r,n,i);const c=localStorage.getItem("access_token");c&&this.setRequestHeader("Authorization",`Bearer ${c}`)}}}.apply(s={},[o,t]),void 0!==a||(a=s),d=function(e,t,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0;class n{constructor(e){this.config=e}static initialize(e){if(!n._instance){const t={domain:e.domain,clientId:e.clientId,redirectUri:e.redirectUri};n._instance=new n(t)}}static getInstance(){return n._instance}generateCodeVerifier(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).slice(-2))).join("")}generateState(){return Math.random().toString(36).substring(2)}generateCodeChallenge(e){return h(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),o=yield window.crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode(...Array.from(new Uint8Array(o)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}))}login(e){return h(this,void 0,void 0,(function*(){const t=this.generateCodeVerifier();localStorage.setItem("code_verifier",t);const o=this.generateState();localStorage.setItem("oauth_state",o),localStorage.setItem("redirect_after_auth",e);const r=yield this.generateCodeChallenge(t),n=`https://${this.config.domain}/authorize?response_type=code&client_id=${this.config.clientId}&redirect_uri=${encodeURIComponent(this.config.redirectUri)}&code_challenge=${r}&code_challenge_method=S256&scope=openid profile email&audience=https://www.coppel.com`;window.location.href=n}))}handleRedirectCallback(e){return h(this,void 0,void 0,(function*(){if(this.isAuthenticated())return;const t=new URLSearchParams(window.location.search),n=localStorage.getItem("code_verifier"),i=localStorage.getItem("redirect_after_auth"),c=t.get("code");if(!c||!n)throw new r.default(500,"Authorization code or code verifier not found");const a=`https://${this.config.domain}`,s={grant_type:"authorization_code",client_id:this.config.clientId,code:c,redirect_uri:this.config.redirectUri,code_verifier:n},d=new o.default(a);try{const t=yield d.postDataFormUrlEncoded("/oauth/token",s),{access_token:o,id_token:r}=t;localStorage.setItem("at",o),localStorage.setItem("it",r),e&&(yield e()),window.history.replaceState({},document.title,window.location.pathname),localStorage.removeItem("redirect_after_auth"),window.location.href=i}catch(e){throw new r.default(501,"Error in oauth/tokenLe")}}))}handleRedirectCallbackHCL(e){return h(this,void 0,void 0,(function*(){if(this.isAuthenticated())return;const t=new URLSearchParams(window.location.search),n=localStorage.getItem("code_verifier"),i=t.get("code");if(!i||!n)throw new r.default(500,"Authorization code or code verifier not found");const c=`https://${this.config.domain}`,a={grant_type:"authorization_code",client_id:this.config.clientId,code:i,redirect_uri:this.config.redirectUri,code_verifier:n},s=new o.default(c);try{const t=yield s.postDataFormUrlEncoded("/oauth/token",a),{access_token:o,id_token:r}=t;localStorage.setItem("at",o),localStorage.setItem("it",r),e&&(yield e()),window.history.replaceState({},document.title,window.location.pathname),window.location.href=this.config.redirectUri}catch(e){throw new r.default(501,"Error in oauth/tokenLe")}}))}getRedirectAfterAuth(){return localStorage.getItem("redirect_after_auth")}validateToken(e){const t=this.getJwtPayload(e),o=Math.floor(Date.now()/1e3);return!(t.exp<o&&(console.error("Token has expired"),1))}getJwtPayload(e){const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(o)}isAuthenticated(){const e=localStorage.getItem("it"),t=localStorage.getItem("at");if(!e||!t)return!1;const o=this.validateToken(e);return console.log("validateToken: "+o),o}getIdToken(){return localStorage.getItem("it")}getAccessToken(){return localStorage.getItem("at")}getUserData(){const e=localStorage.getItem("it");return e?this.getJwtPayload(e):null}logout(e){localStorage.removeItem("at"),localStorage.removeItem("it"),window.location.href=`https://${this.config.domain}/v2/logout?client_id=${this.config.clientId}&returnTo=${encodeURIComponent(e)}`}createAccount(e){localStorage.setItem("redirect_after_auth",e);const t=`https://${this.config.domain}/authorize?response_type=code&client_id=${this.config.clientId}&redirect_uri=${encodeURIComponent(this.config.redirectUri)}&scope=openid profile emailconnection=Username-Password-Authentication&screen_hint=signup`;window.location.href=t}resetPasswordAccount(){const e=`https://${this.config.domain}/lo/reset?client_id=${this.config.clientId}&connection=Username-Password-Authentication`;window.location.href=e}}t.AuthService=n}.apply(l={},[o,t,r,i]),void 0!==d||(d=l),u=function(e,t,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),p(o,t),p(r,t)}.apply(t,[o,t,d,a]),void 0===u||(e.exports=u)}},t={},function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,o),i.exports}(440);var e,t}));